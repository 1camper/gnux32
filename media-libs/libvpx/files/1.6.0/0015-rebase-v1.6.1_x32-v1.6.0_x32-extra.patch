From 9710ce2e2a4a95deb8180cb6d0450fbae51d6b12 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Matthias=20R=C3=A4ncker?= <theonetruecamper@gmx.de>
Date: Mon, 10 Sep 2018 03:06:40 +0200
Subject: [PATCH 15/16] rebase v1.6.1_x32->v1.6.0_x32 extra
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: Matthias RÃ¤ncker <theonetruecamper@gmx.de>
Change-Id: I6153783eedff0d717e78070ec73704141e68d664
---
 third_party/libyuv/source/x86inc.asm       | 3 +++
 vp9/common/vp9_entropymv.h                 | 4 ++--
 vp9/decoder/vp9_decoder.c                  | 2 +-
 vp9/encoder/vp9_encoder.c                  | 2 +-
 vpx_dsp/x86/halfpix_variance_impl_sse2.asm | 6 +++---
 5 files changed, 10 insertions(+), 7 deletions(-)

diff --git a/third_party/libyuv/source/x86inc.asm b/third_party/libyuv/source/x86inc.asm
index cb5c32df3..6c5830515 100644
--- a/third_party/libyuv/source/x86inc.asm
+++ b/third_party/libyuv/source/x86inc.asm
@@ -553,6 +553,9 @@ SECTION .note.GNU-stack noalloc noexec nowrite progbits
 %ifidn __OUTPUT_FORMAT__,elf32
 section .note.GNU-stack noalloc noexec nowrite progbits
 %endif
+%ifidn __OUTPUT_FORMAT__,elfx32
+section .note.GNU-stack noalloc noexec nowrite progbits
+%endif
 %ifidn __OUTPUT_FORMAT__,elf64
 section .note.GNU-stack noalloc noexec nowrite progbits
 %endif
diff --git a/vp9/common/vp9_entropymv.h b/vp9/common/vp9_entropymv.h
index 2f05ad44b..3b42a7182 100644
--- a/vp9/common/vp9_entropymv.h
+++ b/vp9/common/vp9_entropymv.h
@@ -32,8 +32,8 @@ void vp9_adapt_mv_probs(struct VP9Common *cm, int usehp);
 #define COMPANDED_MVREF_THRESH 8
 
 static INLINE int use_mv_hp(const MV *ref) {
-  return (abs(ref->row) >> 3) < COMPANDED_MVREF_THRESH &&
-         (abs(ref->col) >> 3) < COMPANDED_MVREF_THRESH;
+  return (abs((int)ref->row) >> 3) < COMPANDED_MVREF_THRESH &&
+         (abs((int)ref->col) >> 3) < COMPANDED_MVREF_THRESH;
 }
 
 #define MV_UPDATE_PROB 252
diff --git a/vp9/decoder/vp9_decoder.c b/vp9/decoder/vp9_decoder.c
index 04e643a17..935c04f3a 100644
--- a/vp9/decoder/vp9_decoder.c
+++ b/vp9/decoder/vp9_decoder.c
@@ -440,7 +440,7 @@ int vp9_get_raw_frame(VP9Decoder *pbi, YV12_BUFFER_CONFIG *sd,
 
 #if CONFIG_VP9_POSTPROC
   if (!cm->show_existing_frame) {
-    ret = vp9_post_proc_frame(cm, sd, flags, cm->width);
+    ret = vp9_post_proc_frame(cm, sd, flags);
   } else {
     *sd = *cm->frame_to_show;
     ret = 0;
diff --git a/vp9/encoder/vp9_encoder.c b/vp9/encoder/vp9_encoder.c
index 3085355ef..385d6a53d 100644
--- a/vp9/encoder/vp9_encoder.c
+++ b/vp9/encoder/vp9_encoder.c
@@ -5085,7 +5085,7 @@ int vp9_get_preview_raw_frame(VP9_COMP *cpi, YV12_BUFFER_CONFIG *dest,
   } else {
     int ret;
 #if CONFIG_VP9_POSTPROC
-    ret = vp9_post_proc_frame(cm, dest, flags, cpi->un_scaled_source->y_width);
+    ret = vp9_post_proc_frame(cm, dest, flags);
 #else
     if (cm->frame_to_show) {
       *dest = *cm->frame_to_show;
diff --git a/vpx_dsp/x86/halfpix_variance_impl_sse2.asm b/vpx_dsp/x86/halfpix_variance_impl_sse2.asm
index cc26bb612..4223b0b97 100644
--- a/vpx_dsp/x86/halfpix_variance_impl_sse2.asm
+++ b/vpx_dsp/x86/halfpix_variance_impl_sse2.asm
@@ -108,7 +108,7 @@ vpx_half_horiz_vert_variance16x_h_1:
         paddd       xmm0,           xmm1
 
         mov         rsi,            arg(5) ;[Sum]
-        mov         rdi,            arg(6) ;[SSE]
+        mov         rdip,           arg(6) ;[SSE]
 
         movd        [rsi],       xmm0
         movd        [rdi],       xmm6
@@ -213,7 +213,7 @@ vpx_half_vert_variance16x_h_1:
         paddd       xmm0,           xmm1
 
         mov         rsi,            arg(5) ;[Sum]
-        mov         rdi,            arg(6) ;[SSE]
+        mov         rdip,           arg(6) ;[SSE]
 
         movd        [rsi],       xmm0
         movd        [rdi],       xmm6
@@ -315,7 +315,7 @@ vpx_half_horiz_variance16x_h_1:
         paddd       xmm0,           xmm1
 
         mov         rsi,            arg(5) ;[Sum]
-        mov         rdi,            arg(6) ;[SSE]
+        mov         rdip,           arg(6) ;[SSE]
 
         movd        [rsi],       xmm0
         movd        [rdi],       xmm6
-- 
2.16.4

